<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Combo Master - Edi√ß√£o Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
            user-select: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .mode-selector {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .mode-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-card:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-3px);
        }

        .mode-card.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .mode-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .mode-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .player-profile {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .profile-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .xp-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            margin-top: 8px;
        }

        .xp-fill {
            background: linear-gradient(90deg, #4ade80, #22c55e);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .level-progress {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.4em;
            font-weight: bold;
        }

        .level-objective {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4ade80, #22c55e);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9em;
        }

        .shop {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .shop-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .shop-item:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .shop-item:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shop-icon {
            font-size: 1.5em;
        }

        .shop-name {
            font-size: 0.8em;
            text-align: center;
        }

        .shop-price {
            font-size: 0.9em;
            color: #ffd700;
        }

        .shop-owned {
            font-size: 0.8em;
            color: #4ade80;
        }

        .status-panel {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .message {
            font-size: 1.4em;
            font-weight: bold;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .message.success {
            color: #4ade80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }

        .message.error {
            color: #f87171;
            text-shadow: 0 0 10px rgba(248, 113, 113, 0.5);
        }

        .message.special {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .message.animate {
            animation: pulse 1.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }

        .grid-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-width: 500px;
            margin: 0 auto;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .cell:hover:not(.selected):not(:disabled) {
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .cell:hover:not(.selected):not(:disabled)::before {
            transform: translateX(100%);
        }

        .cell.selected {
            background: #ffd700;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            animation: selectedPulse 1s ease-in-out infinite;
        }

        @keyframes selectedPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }

        .cell:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .cell.combo-success {
            animation: comboSuccess 1.5s ease-out;
        }

        .cell.special {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            animation: specialPulse 2s ease-in-out infinite;
        }

        .cell.infected {
            background: linear-gradient(45deg, #8b0000, #ff4444);
            animation: infectedPulse 1.5s ease-in-out infinite;
        }

        .cell.frozen {
            background: linear-gradient(45deg, #87ceeb, #4169e1);
            animation: frozenShimmer 2s ease-in-out infinite;
        }

        .cell.cascade {
            animation: cascadeFall 0.8s ease-out;
        }

        @keyframes comboSuccess {
            0% { transform: scale(1.1); }
            25% { transform: scale(1.4) rotate(15deg); }
            50% { transform: scale(1.3) rotate(-10deg); }
            75% { transform: scale(1.35) rotate(5deg); }
            100% { transform: scale(1.1); }
        }

        @keyframes specialPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 107, 107, 0.6); }
            50% { box-shadow: 0 0 25px rgba(78, 205, 196, 0.8); }
        }

        @keyframes infectedPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(139, 0, 0, 0.8); }
            50% { box-shadow: 0 0 25px rgba(255, 68, 68, 1); }
        }

        @keyframes frozenShimmer {
            0%, 100% { box-shadow: 0 0 15px rgba(135, 206, 235, 0.6); }
            50% { box-shadow: 0 0 25px rgba(65, 105, 225, 0.8); }
        }

        @keyframes cascadeFall {
            0% { transform: translateY(-50px) scale(0.8); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
        }

        .particle.star {
            color: #ffd700;
            font-size: 1.5em;
            animation: starBurst 1s ease-out forwards;
        }

        .particle.coin {
            color: #ffd700;
            font-size: 1.2em;
            animation: coinFloat 1.5s ease-out forwards;
        }

        .particle.xp {
            color: #4ade80;
            font-size: 1em;
            font-weight: bold;
            animation: xpRise 1.5s ease-out forwards;
        }

        @keyframes starBurst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(0.5) rotate(360deg); opacity: 0; }
        }

        @keyframes coinFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(0.8); opacity: 0; }
        }

        @keyframes xpRise {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-80px); opacity: 0; }
        }

        .controls {
            text-align: center;
        }

        .selected-info {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .game-button {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            font-size: 1em;
            font-weight: bold;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .game-button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .game-button:active {
            transform: translateY(0);
        }

        .achievements {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .achievements-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .achievement-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .achievement {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .achievement.unlocked {
            background: rgba(76, 175, 80, 0.3);
        }

        .achievement-icon {
            font-size: 1.5em;
        }

        .achievement-text {
            font-size: 0.9em;
        }

        .game-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .special-mode-ui {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .puzzle-solution {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .infection-spread {
            font-size: 1.1em;
            font-weight: bold;
            color: #ff6b6b;
        }

        @media (max-width: 800px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .cell {
                font-size: 1.5em;
            }
            
            .game-grid {
                gap: 6px;
            }
            
            .mode-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Combo Master</h1>
            <p>A experi√™ncia completa de match-3!</p>
        </div>

        <div class="mode-selector">
            <div class="mode-title">üéØ Selecione o Modo de Jogo</div>
            <div class="mode-grid" id="mode-grid">
                <!-- Modos ser√£o adicionados dinamicamente -->
            </div>
            <button id="start-game-button" class="game-button">üöÄ Iniciar Jogo</button>
        </div>

        <div class="player-profile">
            <div class="profile-card">
                <div class="profile-value" id="player-level">1</div>
                <div class="profile-label">üéñÔ∏è N√≠vel do Jogador</div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <div style="font-size: 0.8em; margin-top: 5px;">
                    <span id="current-xp">0</span> / <span id="xp-needed">100</span> XP
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-value" id="total-coins">0</div>
                <div class="profile-label">ü™ô Moedas</div>
            </div>
            <div class="profile-card">
                <div class="profile-value" id="total-score">0</div>
                <div class="profile-label">üèÜ Melhor Pontua√ß√£o</div>
            </div>
            <div class="profile-card">
                <div class="profile-value" id="games-played">0</div>
                <div class="profile-label">üéÆ Jogos</div>
            </div>
        </div>

        <div class="shop">
            <div class="shop-title">üè™ Loja de Power-ups</div>
            <div class="shop-grid" id="shop-grid">
                <!-- Itens da loja ser√£o adicionados dinamicamente -->
            </div>
        </div>

        <div class="game-stats" id="game-stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">üèÜ Pontos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="combos">0</div>
                <div class="stat-label">‚ö° Combos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="multiplier">1x</div>
                <div class="stat-label">üî• Multiplicador</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">üéØ N√≠vel</div>
            </div>
        </div>

        <div class="level-progress" id="level-progress" style="display: none;">
            <div class="level-header">
                <div class="level-title" id="level-title">Modo Cl√°ssico</div>
                <div id="level-timer"></div>
            </div>
            <div class="level-objective" id="level-objective">Selecione um modo e inicie o jogo!</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">Pronto para come√ßar</div>
        </div>

        <div class="special-mode-ui" id="special-mode-ui" style="display: none;">
            <div id="special-info"></div>
        </div>

        <div class="status-panel">
            <div id="message" class="message">Selecione um modo de jogo para come√ßar!</div>
        </div>

        <div class="grid-container" id="grid-container" style="display: none;">
            <div id="game-grid" class="game-grid"></div>
        </div>

        <div class="controls" id="controls" style="display: none;">
            <div class="selected-info">
                Selecionadas: <span id="selected-count">0</span>/3
                <span id="selected-figures"></span>
            </div>
            
            <div class="button-group">
                <button id="reset-button" class="game-button">
                    üîÑ Reiniciar
                </button>
                <button id="clear-selection-button" class="game-button">
                    üßπ Limpar Sele√ß√£o
                </button>
                <button id="pause-button" class="game-button">
                    ‚è∏Ô∏è Pausar
                </button>
                <button id="menu-button" class="game-button">
                    üè† Menu Principal
                </button>
            </div>
        </div>

        <div class="achievements">
            <div class="achievements-title">üèÖ Conquistas</div>
            <div class="achievement-list" id="achievement-list">
                <!-- Conquistas ser√£o adicionadas dinamicamente -->
            </div>
        </div>
    </div>

    <script>
        var FIGURES = ['üçé', 'üçå', 'üçä', 'üçá', 'üçì', 'ü•ù', 'üçë', 'ü•≠', 'ü••', 'üçí'];
        var GRID_SIZE = 36;
        var BASE_POINTS = 100;
        var MAX_SELECTIONS = 3;
        var ANIMATION_DELAY = 1500;

        var GAME_MODES = [
            {
                id: 'classic',
                name: 'Cl√°ssico',
                icon: 'üéØ',
                desc: 'Progresso atrav√©s de n√≠veis com diferentes objetivos',
                selected: true
            },
            {
                id: 'arcade',
                name: 'Arcade',
                icon: 'üèÉ',
                desc: 'Tempo infinito, foque no high score m√°ximo',
                selected: false
            },
            {
                id: 'blitz',
                name: 'Blitz',
                icon: '‚ö°',
                desc: '60 segundos para fazer o m√°ximo de combos',
                selected: false
            },
            {
                id: 'zen',
                name: 'Zen',
                icon: 'üßò',
                desc: 'Modo relaxante sem press√£o de tempo',
                selected: false
            },
            {
                id: 'puzzle',
                name: 'Puzzle',
                icon: 'üß©',
                desc: 'Desafios com grids pr√©-definidos e solu√ß√µes espec√≠ficas',
                selected: false
            },
            {
                id: 'survival',
                name: 'Sobreviv√™ncia',
                icon: 'ü¶†',
                desc: 'Impe√ßa a infec√ß√£o de se espalhar pelo grid',
                selected: false
            },
            {
                id: 'cascade',
                name: 'Cascata',
                icon: 'üåä',
                desc: 'Combos fazem novas figuras ca√≠rem do topo',
                selected: false
            }
        ];

        var LEVELS = [
            { id: 1, name: 'Iniciante', requirement: 5, type: 'combos', timeLimit: 0, bonus: 50 },
            { id: 2, name: 'Aprendiz', requirement: 10, type: 'combos', timeLimit: 0, bonus: 100 },
            { id: 3, name: 'Explorador', requirement: 800, type: 'points', timeLimit: 0, bonus: 150 },
            { id: 4, name: 'Desafio Tempo', requirement: 8, type: 'combos', timeLimit: 60, bonus: 200 },
            { id: 5, name: 'Mestre', requirement: 15, type: 'combos', timeLimit: 0, bonus: 300 }
        ];

        var SHOP_ITEMS = [
            { id: 'hint', name: 'Dica', icon: 'üí°', price: 25, owned: 3 },
            { id: 'shuffle', name: 'Embaralhar', icon: 'üîÄ', price: 50, owned: 2 },
            { id: 'double', name: '2x Pontos', icon: '‚ú®', price: 100, owned: 1 },
            { id: 'freeze', name: 'Congelar', icon: '‚ùÑÔ∏è', price: 75, owned: 0 },
            { id: 'bomb', name: 'Bomba', icon: 'üí£', price: 150, owned: 0 },
            { id: 'shield', name: 'Escudo', icon: 'üõ°Ô∏è', price: 200, owned: 0 },
            { id: 'xp-boost', name: 'XP Boost', icon: 'üöÄ', price: 80, owned: 0 },
            { id: 'auto-hint', name: 'Auto-Dica', icon: 'ü§ñ', price: 300, owned: 0 }
        ];

        var PUZZLE_GRIDS = [
            // Puzzle f√°cil - apenas ma√ß√£s e bananas
            [
                'üçéüçåüçéüçåüçéüçå',
                'üçåüçéüçåüçéüçåüçé',
                'üçéüçåüçéüçåüçéüçå',
                'üçåüçéüçåüçéüçåüçé',
                'üçéüçåüçéüçåüçéüçå',
                'üçåüçéüçåüçéüçåüçé'
            ],
            // Puzzle m√©dio
            [
                'üçéüçäüçáüçéüçäüçá',
                'üçäüçáüçéüçäüçáüçé',
                'üçáüçéüçäüçáüçéüçä',
                'üçéüçäüçáüçéüçäüçá',
                'üçäüçáüçéüçäüçáüçé',
                'üçáüçéüçäüçáüçéüçä'
            ],
            // Puzzle dif√≠cil
            [
                'üçìü•ùüçëü•≠üçìü•ù',
                'ü•ùüçëü•≠üçìü•ùüçë',
                'üçëü•≠üçìü•ùüçëü•≠',
                'ü•≠üçìü•ùüçëü•≠üçì',
                'üçìü•ùüçëü•≠üçìü•ù',
                'ü•ùüçëü•≠üçìü•ùüçë'
            ]
        ];

        var ACHIEVEMENTS = [
            { id: 'first_combo', name: 'Primeiro Combo', desc: 'Fa√ßa seu primeiro combo', icon: 'üéØ', unlocked: false },
            { id: 'combo_streak', name: 'Sequ√™ncia', desc: 'Fa√ßa 5 combos seguidos', icon: 'üî•', unlocked: false },
            { id: 'speed_demon', name: 'Dem√¥nio da Velocidade', desc: 'Complete um n√≠vel em menos de 30s', icon: '‚ö°', unlocked: false },
            { id: 'power_user', name: 'Usu√°rio de Power', desc: 'Use todos os power-ups', icon: '‚≠ê', unlocked: false },
            { id: 'level_5', name: 'Meio Caminho', desc: 'Alcance o n√≠vel 5', icon: 'üèîÔ∏è', unlocked: false },
            { id: 'high_score', name: 'Pontuador', desc: 'Alcance 5000 pontos', icon: 'üèÜ', unlocked: false },
            { id: 'rich_player', name: 'Rico', desc: 'Acumule 1000 moedas', icon: 'üí∞', unlocked: false },
            { id: 'all_modes', name: 'Explorador', desc: 'Jogue todos os modos', icon: 'üåç', unlocked: false }
        ];

        function getRandomFigure() {
            return FIGURES[Math.floor(Math.random() * FIGURES.length)];
        }

        function savePlayerData() {
            var data = {
                playerLevel: game.playerLevel,
                totalXP: game.totalXP,
                totalCoins: game.totalCoins,
                totalScore: game.totalScore,
                gamesPlayed: game.gamesPlayed,
                achievements: game.achievements,
                shopItems: SHOP_ITEMS,
                modesPlayed: game.modesPlayed || []
            };
            localStorage.setItem('comboMasterData', JSON.stringify(data));
        }

        function loadPlayerData() {
            var data = localStorage.getItem('comboMasterData');
            if (data) {
                return JSON.parse(data);
            }
            return null;
        }

        function ComboGame() {
            this.currentMode = 'classic';
            this.gameActive = false;
            this.grid = [];
            this.selected = [];
            this.score = 0;
            this.combos = 0;
            this.level = 1;
            this.multiplier = 1;
            this.isProcessing = false;
            this.isPaused = false;
            this.elements = {};
            
            // Sistema de progress√£o do jogador
            this.playerLevel = 1;
            this.totalXP = 0;
            this.totalCoins = 0;
            this.totalScore = 0;
            this.gamesPlayed = 0;
            this.modesPlayed = [];
            
            // Power-ups espec√≠ficos por item da loja
            this.activePowerUps = {
                hint: 0,
                shuffle: 0,
                double: 0,
                freeze: 0,
                bomb: 0,
                shield: 0,
                xpBoost: 0,
                autoHint: 0
            };
            
            this.achievements = JSON.parse(JSON.stringify(ACHIEVEMENTS));
            this.gameStartTime = Date.now();
            this.levelStartTime = Date.now();
            this.timeLimit = 0;
            this.timerInterval = null;
            
            // Vari√°veis espec√≠ficas do modo
            this.modeData = {};
            this.currentPuzzle = 0;
            this.infectedCells = [];
            this.frozenCells = [];
            this.cascadeLevel = 0;
            
            this.init();
        }

        ComboGame.prototype.init = function() {
            this.initElements();
            this.loadPlayerProgress();
            this.renderModes();
            this.renderShop();
            this.bindEvents();
            this.updatePlayerUI();
            this.renderAchievements();
        };

        ComboGame.prototype.initElements = function() {
            this.elements.modeGrid = document.getElementById('mode-grid');
            this.elements.startButton = document.getElementById('start-game-button');
            this.elements.shopGrid = document.getElementById('shop-grid');
            this.elements.playerLevel = document.getElementById('player-level');
            this.elements.currentXP = document.getElementById('current-xp');
            this.elements.xpNeeded = document.getElementById('xp-needed');
            this.elements.xpFill = document.getElementById('xp-fill');
            this.elements.totalCoins = document.getElementById('total-coins');
            this.elements.totalScore = document.getElementById('total-score');
            this.elements.gamesPlayed = document.getElementById('games-played');
            
            this.elements.gameStats = document.getElementById('game-stats');
            this.elements.levelProgress = document.getElementById('level-progress');
            this.elements.gridContainer = document.getElementById('grid-container');
            this.elements.controls = document.getElementById('controls');
            this.elements.specialModeUI = document.getElementById('special-mode-ui');
            this.elements.specialInfo = document.getElementById('special-info');
            
            this.elements.score = document.getElementById('score');
            this.elements.combos = document.getElementById('combos');
            this.elements.multiplier = document.getElementById('multiplier');
            this.elements.level = document.getElementById('level');
            this.elements.levelTitle = document.getElementById('level-title');
            this.elements.levelObjective = document.getElementById('level-objective');
            this.elements.levelTimer = document.getElementById('level-timer');
            this.elements.progressFill = document.getElementById('progress-fill');
            this.elements.progressText = document.getElementById('progress-text');
            this.elements.message = document.getElementById('message');
            this.elements.gameGrid = document.getElementById('game-grid');
            this.elements.selectedCount = document.getElementById('selected-count');
            this.elements.selectedFigures = document.getElementById('selected-figures');
            this.elements.resetButton = document.getElementById('reset-button');
            this.elements.clearButton = document.getElementById('clear-selection-button');
            this.elements.pauseButton = document.getElementById('pause-button');
            this.elements.menuButton = document.getElementById('menu-button');
            this.elements.achievementList = document.getElementById('achievement-list');
        };

        ComboGame.prototype.loadPlayerProgress = function() {
            var data = loadPlayerData();
            if (data) {
                this.playerLevel = data.playerLevel || 1;
                this.totalXP = data.totalXP || 0;
                this.totalCoins = data.totalCoins || 0;
                this.totalScore = data.totalScore || 0;
                this.gamesPlayed = data.gamesPlayed || 0;
                this.achievements = data.achievements || this.achievements;
                this.modesPlayed = data.modesPlayed || [];
                
                // Atualizar itens da loja
                if (data.shopItems) {
                    for (var i = 0; i < SHOP_ITEMS.length; i++) {
                        var savedItem = data.shopItems.find(function(item) {
                            return item.id === SHOP_ITEMS[i].id;
                        });
                        if (savedItem) {
                            SHOP_ITEMS[i].owned = savedItem.owned;
                        }
                    }
                }
            }
        };

        ComboGame.prototype.renderModes = function() {
            this.elements.modeGrid.innerHTML = '';
            
            for (var i = 0; i < GAME_MODES.length; i++) {
                var mode = GAME_MODES[i];
                var div = document.createElement('div');
                div.className = 'mode-card';
                if (mode.selected) div.className += ' selected';
                div.setAttribute('data-mode', mode.id);
                
                div.innerHTML = 
                    '<div class="mode-icon">' + mode.icon + '</div>' +
                    '<div class="mode-name">' + mode.name + '</div>' +
                    '<div class="mode-desc">' + mode.desc + '</div>';
                
                var self = this;
                div.onclick = function() {
                    self.selectMode(this.getAttribute('data-mode'));
                };
                
                this.elements.modeGrid.appendChild(div);
            }
        };

        ComboGame.prototype.renderShop = function() {
            this.elements.shopGrid.innerHTML = '';
            
            for (var i = 0; i < SHOP_ITEMS.length; i++) {
                var item = SHOP_ITEMS[i];
                var button = document.createElement('button');
                button.className = 'shop-item';
                button.setAttribute('data-item', item.id);
                button.disabled = this.totalCoins < item.price;
                
                var content = 
                    '<div class="shop-icon">' + item.icon + '</div>' +
                    '<div class="shop-name">' + item.name + '</div>';
                    
                if (item.owned > 0) {
                    content += '<div class="shop-owned">Possui: ' + item.owned + '</div>';
                } else {
                    content += '<div class="shop-price">ü™ô ' + item.price + '</div>';
                }
                
                button.innerHTML = content;
                
                var self = this;
                button.onclick = function() {
                    self.buyItem(this.getAttribute('data-item'));
                };
                
                this.elements.shopGrid.appendChild(button);
            }
        };

        ComboGame.prototype.selectMode = function(modeId) {
            for (var i = 0; i < GAME_MODES.length; i++) {
                GAME_MODES[i].selected = GAME_MODES[i].id === modeId;
            }
            this.currentMode = modeId;
            this.renderModes();
        };

        ComboGame.prototype.buyItem = function(itemId) {
            var item = SHOP_ITEMS.find(function(i) { return i.id === itemId; });
            if (!item || this.totalCoins < item.price) return;
            
            this.totalCoins -= item.price;
            item.owned++;
            
            this.activePowerUps[itemId.replace('-', '')]++;
            
            this.showMessage('üõçÔ∏è ' + item.name + ' comprado!', 'success', true);
            this.updatePlayerUI();
            this.renderShop();
            this.saveProgress();
        };

        ComboGame.prototype.bindEvents = function() {
            var self = this;
            
            this.elements.startButton.onclick = function() {
                self.startGame();
            };
            
            this.elements.resetButton.onclick = function() {
                self.resetGame();
            };
            
            this.elements.clearButton.onclick = function() {
                self.clearSelection();
            };

            this.elements.pauseButton.onclick = function() {
                self.togglePause();
            };

            this.elements.menuButton.onclick = function() {
                self.returnToMenu();
            };
        };

        ComboGame.prototype.startGame = function() {
            if (!this.modesPlayed.includes(this.currentMode)) {
                this.modesPlayed.push(this.currentMode);
            }
            
            this.gameActive = true;
            this.gamesPlayed++;
            this.gameStartTime = Date.now();
            
            // Esconder menu e mostrar jogo
            document.querySelector('.mode-selector').style.display = 'none';
            document.querySelector('.shop').style.display = 'none';
            this.elements.gameStats.style.display = 'grid';
            this.elements.levelProgress.style.display = 'block';
            this.elements.gridContainer.style.display = 'block';
            this.elements.controls.style.display = 'block';
            
            // Configurar modo espec√≠fico
            this.initModeSpecifics();
            this.initGrid();
            this.renderGrid();
            this.updateUI();
            this.updateModeUI();
            
            this.showMessage('üéÆ Jogo iniciado! Modo: ' + this.getModeByName(), 'success', true);
            
            // Copiar power-ups da loja para uso no jogo
            for (var itemId in this.activePowerUps) {
                var shopItem = SHOP_ITEMS.find(function(item) {
                    return item.id === itemId || item.id.replace('-', '') === itemId;
                });
                if (shopItem) {
                    this.activePowerUps[itemId] = shopItem.owned;
                }
            }
        };

        ComboGame.prototype.getModeByName = function() {
            var mode = GAME_MODES.find(function(m) { return m.id === this.currentMode; }.bind(this));
            return mode ? mode.name : 'Desconhecido';
        };

        ComboGame.prototype.initModeSpecifics = function() {
            switch (this.currentMode) {
                case 'blitz':
                    this.timeLimit = 60;
                    this.startTimer();
                    break;
                case 'puzzle':
                    this.currentPuzzle = Math.floor(Math.random() * PUZZLE_GRIDS.length);
                    break;
                case 'survival':
                    this.infectedCells = [];
                    this.spreadInfection();
                    break;
                case 'cascade':
                    this.cascadeLevel = 1;
                    break;
                default:
                    this.timeLimit = 0;
            }
        };

        ComboGame.prototype.initGrid = function() {
            this.grid = [];
            
            if (this.currentMode === 'puzzle') {
                // Grid pr√©-definido para puzzles
                var puzzleGrid = PUZZLE_GRIDS[this.currentPuzzle];
                for (var i = 0; i < 6; i++) {
                    for (var j = 0; j < 6; j++) {
                        this.grid.push({
                            id: i * 6 + j,
                            figure: puzzleGrid[i][j],
                            selected: false,
                            element: null,
                            special: false,
                            infected: false,
                            frozen: false
                        });
                    }
                }
            } else {
                // Grid aleat√≥rio para outros modos
                var figureCount = this.currentMode === 'zen' ? 4 : Math.min(6 + Math.floor(this.level / 2), FIGURES.length);
                var availableFigures = FIGURES.slice(0, figureCount);
                
                for (var k = 0; k < GRID_SIZE; k++) {
                    this.grid.push({
                        id: k,
                        figure: availableFigures[Math.floor(Math.random() * availableFigures.length)],
                        selected: false,
                        element: null,
                        special: false,
                        infected: false,
                        frozen: false
                    });
                }
            }
            
            // Adicionar c√©lulas especiais baseado no modo
            if (this.currentMode === 'survival') {
                this.applyInfection();
            }
        };

        ComboGame.prototype.renderGrid = function() {
            this.elements.gameGrid.innerHTML = '';
            
            for (var i = 0; i < this.grid.length; i++) {
                var cell = this.grid[i];
                var button = this.createButton(cell);
                cell.element = button;
                this.elements.gameGrid.appendChild(button);
            }
        };

        ComboGame.prototype.createButton = function(cell) {
            var button = document.createElement('button');
            button.className = 'cell';
            if (cell.selected) button.className += ' selected';
            if (cell.special) button.className += ' special';
            if (cell.infected) button.className += ' infected';
            if (cell.frozen) button.className += ' frozen';
            button.textContent = cell.figure;
            button.disabled = this.isProcessing || this.isPaused || (this.selected.length >= MAX_SELECTIONS && !cell.selected);
            
            var self = this;
            button.onclick = function() {
                self.handleClick(cell.id);
            };
            
            return button;
        };

        ComboGame.prototype.handleClick = function(id) {
            if (this.isProcessing || this.isPaused || !this.gameActive) return;
            
            var cell = this.findCell(id);
            if (!cell || cell.selected) return;
            
            // Verificar se a c√©lula est√° congelada
            if (cell.frozen) {
                if (this.activePowerUps.freeze > 0) {
                    cell.frozen = false;
                    this.activePowerUps.freeze--;
                    this.showMessage('‚ùÑÔ∏è C√©lula descongelada!', 'special');
                    this.updateButtonClass(cell);
                    return;
                } else {
                    this.showMessage('‚ùÑÔ∏è C√©lula congelada! Use power-up Congelar.', 'error');
                    return;
                }
            }
            
            this.selectCell(cell);
            this.updateUI();
            
            if (this.selected.length === MAX_SELECTIONS) {
                this.processCombo();
            } else {
                this.showMessage('Selecionadas: ' + this.selected.length + '/' + MAX_SELECTIONS);
            }
        };

        ComboGame.prototype.findCell = function(id) {
            for (var i = 0; i < this.grid.length; i++) {
                if (this.grid[i].id === id) {
                    return this.grid[i];
                }
            }
            return null;
        };

        ComboGame.prototype.selectCell = function(cell) {
            cell.selected = true;
            this.selected.push(cell);
            this.updateButtonClass(cell);
            this.updateCellStates();
        };

        ComboGame.prototype.updateButtonClass = function(cell) {
            if (cell.element) {
                cell.element.className = 'cell';
                if (cell.selected) cell.element.className += ' selected';
                if (cell.special) cell.element.className += ' special';
                if (cell.infected) cell.element.className += ' infected';
                if (cell.frozen) cell.element.className += ' frozen';
            }
        };

        ComboGame.prototype.updateCellStates = function() {
            var shouldDisable = this.selected.length >= MAX_SELECTIONS;
            
            for (var i = 0; i < this.grid.length; i++) {
                var cell = this.grid[i];
                if (cell.element && !cell.selected) {
                    cell.element.disabled = shouldDisable || this.isProcessing || this.isPaused;
                }
            }
        };

        ComboGame.prototype.processCombo = function() {
            var self = this;
            this.isProcessing = true;
            this.disableGame();
            
            setTimeout(function() {
                self.checkCombo();
            }, 100);
        };

        ComboGame.prototype.checkCombo = function() {
            var first = this.selected[0].figure;
            var second = this.selected[1].figure;
            var third = this.selected[2].figure;
            
            if (first === second && second === third) {
                this.handleSuccess();
            } else {
                this.handleFailure();
            }
        };

        ComboGame.prototype.handleSuccess = function() {
            var self = this;
            
            var basePoints = BASE_POINTS;
            var specialBonus = 0;
            var hasSpecial = false;
            var hasInfected = false;

            // Calcular b√¥nus especiais
            for (var i = 0; i < this.selected.length; i++) {
                var cell = this.selected[i];
                if (cell.special) {
                    hasSpecial = true;
                    specialBonus += 50;
                }
                if (cell.infected) {
                    hasInfected = true;
                    specialBonus += 100; // Curar infec√ß√£o d√° mais pontos
                }
            }

            // Aplicar multiplicadores
            var totalPoints = Math.floor((basePoints + specialBonus) * this.multiplier);
            if (this.activePowerUps.double > 0) {
                totalPoints *= 2;
                this.activePowerUps.double--;
            }

            this.score += totalPoints;
            this.combos++;

            // Ganhar XP e moedas
            var xpGained = Math.floor(totalPoints / 10);
            if (this.activePowerUps.xpBoost > 0) {
                xpGained *= 2;
                this.activePowerUps.xpBoost--;
            }
            
            var coinsGained = Math.floor(totalPoints / 50);
            if (hasSpecial) coinsGained += 2;
            if (hasInfected) coinsGained += 5;

            this.gainXP(xpGained);
            this.gainCoins(coinsGained);

            // Criar efeitos visuais
            this.createParticleEffects();

            // Atualizar multiplicador
            this.multiplier = Math.min(this.multiplier + 0.2, 3);

            this.updateScore();
            
            // Adicionar anima√ß√£o √†s c√©lulas do combo
            for (var j = 0; j < this.selected.length; j++) {
                var cell = this.selected[j];
                if (cell.element && cell.element.classList) {
                    cell.element.classList.add('combo-success');
                }
            }

            var message = 'üéâ COMBO! +' + totalPoints + ' pontos!';
            if (hasSpecial) message += ' ‚≠ê ESPECIAL!';
            if (hasInfected) message += ' ü¶† CURADO!';
            if (xpGained > 0) message += ' +' + xpGained + ' XP';
            if (coinsGained > 0) message += ' +' + coinsGained + ' ü™ô';
            
            this.showMessage(message, 'success', true);
            this.checkAchievements();
            
            setTimeout(function() {
                self.replaceCells();
                self.clearSelection();
                self.checkModeProgress();
                self.enableGame();
                self.clearMessage();
            }, ANIMATION_DELAY);
        };

        ComboGame.prototype.handleFailure = function() {
            var self = this;
            
            this.multiplier = 1;
            
            // Verificar se tem escudo
            if (this.activePowerUps.shield > 0) {
                this.activePowerUps.shield--;
                this.showMessage('üõ°Ô∏è Escudo ativado! Erro bloqueado!', 'special', true);
            } else {
                this.showMessage('‚ùå N√£o combinou! Tente novamente.', 'error', true);
                
                // Espalhar infec√ß√£o no modo sobreviv√™ncia
                if (this.currentMode === 'survival') {
                    this.spreadInfection();
                }
            }
            
            setTimeout(function() {
                self.clearSelection();
                self.enableGame();
                self.clearMessage();
            }, ANIMATION_DELAY);
        };

        ComboGame.prototype.replaceCells = function() {
            var figureCount = this.currentMode === 'zen' ? 4 : Math.min(6 + Math.floor(this.level / 2), FIGURES.length);
            var availableFigures = FIGURES.slice(0, figureCount);

            for (var i = 0; i < this.selected.length; i++) {
                var selectedCell = this.selected[i];
                var gridCell = this.findCell(selectedCell.id);
                
                if (gridCell) {
                    // Cura infec√ß√£o se a c√©lula estava infectada
                    if (gridCell.infected) {
                        gridCell.infected = false;
                        this.removeFromInfectedList(gridCell.id);
                    }
                    
                    gridCell.figure = availableFigures[Math.floor(Math.random() * availableFigures.length)];
                    gridCell.selected = false;
                    gridCell.special = false;

                    // Chance de c√©lula especial baseada no n√≠vel
                    if (this.level >= 3 && Math.random() < 0.1) {
                        gridCell.special = true;
                    }

                    // No modo cascata, aplicar anima√ß√£o de queda
                    if (this.currentMode === 'cascade') {
                        if (gridCell.element) {
                            gridCell.element.classList.add('cascade');
                        }
                    }
                    
                    if (gridCell.element) {
                        gridCell.element.textContent = gridCell.figure;
                        this.updateButtonClass(gridCell);
                        if (gridCell.element.classList) {
                            gridCell.element.classList.remove('combo-success');
                        }
                    }
                }
            }
        };

        ComboGame.prototype.removeFromInfectedList = function(cellId) {
            this.infectedCells = this.infectedCells.filter(function(id) {
                return id !== cellId;
            });
        };

        ComboGame.prototype.clearSelection = function() {
            for (var i = 0; i < this.selected.length; i++) {
                var cell = this.selected[i];
                cell.selected = false;
                this.updateButtonClass(cell);
                if (cell.element) {
                    cell.element.disabled = this.isProcessing || this.isPaused;
                }
            }
            
            this.selected = [];
            this.updateUI();
            this.clearMessage();
        };

        ComboGame.prototype.createParticleEffects = function() {
            // Criar part√≠culas de estrela, moeda e XP
            for (var i = 0; i < this.selected.length; i++) {
                var cell = this.selected[i];
                if (cell.element) {
                    var rect = cell.element.getBoundingClientRect();
                    this.createParticle('‚≠ê', rect.left + rect.width/2, rect.top + rect.height/2, 'star');
                    this.createParticle('ü™ô', rect.left + rect.width/2 + 20, rect.top + rect.height/2, 'coin');
                    this.createParticle('+XP', rect.left + rect.width/2 - 20, rect.top + rect.height/2, 'xp');
                }
            }
        };

        ComboGame.prototype.createParticle = function(text, x, y, type) {
            var particle = document.createElement('div');
            particle.className = 'particle ' + type;
            particle.textContent = text;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            
            document.body.appendChild(particle);
            
            setTimeout(function() {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 1500);
        };

        ComboGame.prototype.gainXP = function(amount) {
            this.totalXP += amount;
            var xpNeeded = this.playerLevel * 100;
            
            if (this.totalXP >= xpNeeded) {
                this.playerLevel++;
                this.totalXP -= xpNeeded;
                this.showMessage('üéñÔ∏è LEVEL UP! Agora voc√™ √© n√≠vel ' + this.playerLevel + '!', 'special', true);
                
                // Bonus por level up
                this.totalCoins += this.playerLevel * 10;
            }
        };

        ComboGame.prototype.gainCoins = function(amount) {
            this.totalCoins += amount;
            
            if (this.totalCoins >= 1000) {
                this.unlockAchievement('rich_player');
            }
        };

        ComboGame.prototype.checkModeProgress = function() {
            switch (this.currentMode) {
                case 'classic':
                    this.checkLevelProgress();
                    break;
                case 'arcade':
                    // Modo arcade n√£o tem progress√£o espec√≠fica
                    break;
                case 'blitz':
                    // Progress√£o baseada em tempo
                    break;
                case 'zen':
                    // Modo zen √© infinito
                    break;
                case 'puzzle':
                    this.checkPuzzleComplete();
                    break;
                case 'survival':
                    this.checkSurvivalStatus();
                    break;
                case 'cascade':
                    this.increaseCascadeLevel();
                    break;
            }
        };

        ComboGame.prototype.checkLevelProgress = function() {
            if (this.level <= LEVELS.length) {
                var currentLevel = LEVELS[this.level - 1];
                var progress = 0;
                var completed = false;

                if (currentLevel.type === 'combos') {
                    progress = this.combos;
                    completed = this.combos >= currentLevel.requirement;
                } else if (currentLevel.type === 'points') {
                    progress = this.score;
                    completed = this.score >= currentLevel.requirement;
                }

                this.updateProgress(progress, currentLevel.requirement);

                if (completed) {
                    this.levelUp();
                }
            }
        };

        ComboGame.prototype.checkPuzzleComplete = function() {
            // Verificar se o puzzle foi resolvido
            var remainingCombos = this.findPossibleCombos();
            if (remainingCombos.length === 0) {
                this.showMessage('üß© PUZZLE RESOLVIDO! Carregando pr√≥ximo...', 'success', true);
                var self = this;
                setTimeout(function() {
                    self.nextPuzzle();
                }, 2000);
            }
        };

        ComboGame.prototype.nextPuzzle = function() {
            this.currentPuzzle = (this.currentPuzzle + 1) % PUZZLE_GRIDS.length;
            this.initGrid();
            this.renderGrid();
            this.updateModeUI();
        };

        ComboGame.prototype.checkSurvivalStatus = function() {
            if (this.infectedCells.length === 0) {
                this.showMessage('ü¶† INFEC√á√ÉO CURADA! Parab√©ns!', 'success', true);
                this.gainXP(100);
                this.gainCoins(50);
            } else if (this.infectedCells.length >= GRID_SIZE / 2) {
                this.showMessage('üíÄ INFEC√á√ÉO SE ESPALHOU DEMAIS! Game Over!', 'error', true);
                var self = this;
                setTimeout(function() {
                    self.gameOver();
                }, 2000);
            }
        };

        ComboGame.prototype.spreadInfection = function() {
            // Espalhar infec√ß√£o para c√©lulas adjacentes
            var newInfections = [];
            
            for (var i = 0; i < this.infectedCells.length; i++) {
                var cellId = this.infectedCells[i];
                var neighbors = this.getNeighbors(cellId);
                
                for (var j = 0; j < neighbors.length; j++) {
                    var neighbor = neighbors[j];
                    if (!neighbor.infected && Math.random() < 0.3) {
                        neighbor.infected = true;
                        newInfections.push(neighbor.id);
                        this.updateButtonClass(neighbor);
                    }
                }
            }
            
            this.infectedCells = this.infectedCells.concat(newInfections);
        };

        ComboGame.prototype.applyInfection = function() {
            // Infectar algumas c√©lulas iniciais
            var initialInfections = Math.floor(GRID_SIZE / 12);
            for (var i = 0; i < initialInfections; i++) {
                var randomIndex = Math.floor(Math.random() * GRID_SIZE);
                var cell = this.grid[randomIndex];
                if (!cell.infected) {
                    cell.infected = true;
                    this.infectedCells.push(cell.id);
                }
            }
        };

        ComboGame.prototype.getNeighbors = function(cellId) {
            var neighbors = [];
            var row = Math.floor(cellId / 6);
            var col = cellId % 6;
            
            var directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            for (var i = 0; i < directions.length; i++) {
                var newRow = row + directions[i][0];
                var newCol = col + directions[i][1];
                
                if (newRow >= 0 && newRow < 6 && newCol >= 0 && newCol < 6) {
                    var neighborId = newRow * 6 + newCol;
                    var neighbor = this.findCell(neighborId);
                    if (neighbor) {
                        neighbors.push(neighbor);
                    }
                }
            }
            
            return neighbors;
        };

        ComboGame.prototype.increaseCascadeLevel = function() {
            this.cascadeLevel++;
            if (this.cascadeLevel % 5 === 0) {
                this.showMessage('üåä N√çVEL DE CASCATA ' + this.cascadeLevel + '!', 'special', true);
                this.gainXP(25);
                this.gainCoins(10);
            }
        };

        ComboGame.prototype.updateProgress = function(current, target) {
            var percentage = Math.min((current / target) * 100, 100);
            this.elements.progressFill.style.width = percentage + '%';
            this.elements.progressText.textContent = current + ' / ' + target;
        };

        ComboGame.prototype.levelUp = function() {
            if (this.level < LEVELS.length) {
                var currentLevel = LEVELS[this.level - 1];
                this.score += currentLevel.bonus;
                this.gainXP(currentLevel.bonus);
                this.gainCoins(currentLevel.bonus / 5);

                this.level++;
                this.levelStartTime = Date.now();
                
                this.updateLevel();
                this.initGrid();
                this.renderGrid();
                
                this.showMessage('üéâ N√çVEL ' + this.level + ' DESBLOQUEADO! +' + currentLevel.bonus + ' bonus!', 'special', true);
                this.checkAchievements();
            } else {
                this.showMessage('üèÜ PARAB√âNS! VOC√ä COMPLETOU TODOS OS N√çVEIS!', 'special', true);
                this.gameComplete();
            }
        };

        ComboGame.prototype.updateLevel = function() {
            if (this.currentMode === 'classic' && this.level <= LEVELS.length) {
                var currentLevel = LEVELS[this.level - 1];
                this.elements.levelTitle.textContent = 'N√≠vel ' + this.level + ': ' + currentLevel.name;
                
                var objective = 'Objetivo: ';
                if (currentLevel.type === 'combos') {
                    objective += 'Fa√ßa ' + currentLevel.requirement + ' combos';
                } else {
                    objective += 'Alcance ' + currentLevel.requirement + ' pontos';
                }
                if (currentLevel.timeLimit > 0) {
                    objective += ' em ' + currentLevel.timeLimit + ' segundos';
                }
                objective += '!';
                
                this.elements.levelObjective.textContent = objective;
                
                if (currentLevel.timeLimit > 0) {
                    this.timeLimit = currentLevel.timeLimit;
                    this.startTimer();
                } else {
                    this.timeLimit = 0;
                    this.stopTimer();
                    this.elements.levelTimer.textContent = '';
                }

                this.updateProgress(0, currentLevel.requirement);
            }
        };

        ComboGame.prototype.updateModeUI = function() {
            var modeInfo = '';
            
            switch (this.currentMode) {
                case 'classic':
                    this.updateLevel();
                    break;
                case 'arcade':
                    this.elements.levelTitle.textContent = 'Modo Arcade';
                    this.elements.levelObjective.textContent = 'Fa√ßa o m√°ximo de pontos poss√≠vel!';
                    break;
                case 'blitz':
                    this.elements.levelTitle.textContent = 'Modo Blitz';
                    this.elements.levelObjective.textContent = 'M√°ximo de combos em 60 segundos!';
                    break;
                case 'zen':
                    this.elements.levelTitle.textContent = 'Modo Zen';
                    this.elements.levelObjective.textContent = 'Relaxe e fa√ßa combos sem pressa!';
                    break;
                case 'puzzle':
                    this.elements.levelTitle.textContent = 'Modo Puzzle';
                    this.elements.levelObjective.textContent = 'Resolva o puzzle ' + (this.currentPuzzle + 1) + '/' + PUZZLE_GRIDS.length;
                    modeInfo = '<div class="puzzle-solution">üí° Dica: Procure padr√µes e sequ√™ncias!</div>';
                    break;
                case 'survival':
                    this.elements.levelTitle.textContent = 'Modo Sobreviv√™ncia';
                    this.elements.levelObjective.textContent = 'Cure a infec√ß√£o antes que se espalhe!';
                    modeInfo = '<div class="infection-spread">ü¶† C√©lulas infectadas: ' + this.infectedCells.length + '</div>';
                    break;
                case 'cascade':
                    this.elements.levelTitle.textContent = 'Modo Cascata';
                    this.elements.levelObjective.textContent = 'Crie cascatas de combos!';
                    modeInfo = '<div class="infection-spread">üåä N√≠vel de Cascata: ' + this.cascadeLevel + '</div>';
                    break;
            }
            
            if (modeInfo) {
                this.elements.specialModeUI.style.display = 'block';
                this.elements.specialInfo.innerHTML = modeInfo;
            } else {
                this.elements.specialModeUI.style.display = 'none';
            }
        };

        ComboGame.prototype.findPossibleCombos = function() {
            var combos = [];
            var figures = {};
            
            for (var i = 0; i < this.grid.length; i++) {
                var cell = this.grid[i];
                if (!cell.infected && !cell.frozen) { // N√£o contar c√©lulas problem√°ticas
                    if (!figures[cell.figure]) {
                        figures[cell.figure] = [];
                    }
                    figures[cell.figure].push(cell);
                }
            }

            for (var figure in figures) {
                if (figures[figure].length >= 3) {
                    combos.push(figures[figure].slice(0, 3));
                }
            }

            return combos;
        };

        ComboGame.prototype.startTimer = function() {
            var self = this;
            this.stopTimer();
            
            this.timerInterval = setInterval(function() {
                self.timeLimit--;
                self.elements.levelTimer.textContent = '‚è∞ ' + self.timeLimit + 's';
                
                if (self.timeLimit <= 0) {
                    self.stopTimer();
                    self.timeUp();
                }
            }, 1000);
        };

        ComboGame.prototype.stopTimer = function() {
            if (this.timerInterval) {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
            }
        };

        ComboGame.prototype.timeUp = function() {
            this.showMessage('‚è∞ Tempo esgotado!', 'error', true);
            
            if (this.currentMode === 'blitz') {
                this.gameOver();
            } else {
                var self = this;
                setTimeout(function() {
                    self.resetGame();
                }, 2000);
            }
        };

        ComboGame.prototype.gameOver = function() {
            this.gameActive = false;
            this.saveProgress();
            
            var finalMessage = 'üéÆ GAME OVER!\n';
            finalMessage += 'üèÜ Pontua√ß√£o Final: ' + this.score + '\n';
            finalMessage += '‚ö° Combos Totais: ' + this.combos + '\n';
            finalMessage += 'ü™ô Moedas Ganhas: ' + Math.floor(this.score / 50);
            
            this.showMessage(finalMessage.replace(/\n/g, ' | '), 'special', true);
            
            var self = this;
            setTimeout(function() {
                self.returnToMenu();
            }, 4000);
        };

        ComboGame.prototype.gameComplete = function() {
            this.gameActive = false;
            this.gainXP(500);
            this.gainCoins(100);
            this.saveProgress();
            
            this.showMessage('üèÜ JOGO COMPLETO! Parab√©ns!', 'special', true);
            
            var self = this;
            setTimeout(function() {
                self.returnToMenu();
            }, 3000);
        };

        ComboGame.prototype.togglePause = function() {
            this.isPaused = !this.isPaused;
            this.elements.pauseButton.textContent = this.isPaused ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar';
            
            if (this.isPaused) {
                this.stopTimer();
                this.showMessage('‚è∏Ô∏è Jogo pausado', 'special');
            } else {
                if (this.timeLimit > 0) {
                    this.startTimer();
                }
                this.clearMessage();
            }
            
            this.updateCellStates();
        };

        ComboGame.prototype.checkAchievements = function() {
            if (this.combos >= 1) {
                this.unlockAchievement('first_combo');
            }

            if (this.combos >= 5) {
                this.unlockAchievement('combo_streak');
            }

            if (this.score >= 5000) {
                this.unlockAchievement('high_score');
            }

            if (this.level >= 5) {
                this.unlockAchievement('level_5');
            }

            if (this.modesPlayed.length >= GAME_MODES.length) {
                this.unlockAchievement('all_modes');
            }
        };

        ComboGame.prototype.unlockAchievement = function(id) {
            for (var i = 0; i < this.achievements.length; i++) {
                if (this.achievements[i].id === id && !this.achievements[i].unlocked) {
                    this.achievements[i].unlocked = true;
                    this.showMessage('üèÖ CONQUISTA: ' + this.achievements[i].name + '!', 'special', true);
                    this.renderAchievements();
                    this.gainXP(50);
                    this.gainCoins(25);
                    this.saveProgress();
                    break;
                }
            }
        };

        ComboGame.prototype.renderAchievements = function() {
            this.elements.achievementList.innerHTML = '';
            
            for (var i = 0; i < this.achievements.length; i++) {
                var achievement = this.achievements[i];
                var div = document.createElement('div');
                div.className = 'achievement' + (achievement.unlocked ? ' unlocked' : '');
                
                div.innerHTML = 
                    '<div class="achievement-icon">' + achievement.icon + '</div>' +
                    '<div class="achievement-text">' +
                        '<strong>' + achievement.name + '</strong><br>' +
                        '<small>' + achievement.desc + '</small>' +
                    '</div>';
                
                this.elements.achievementList.appendChild(div);
            }
        };

        ComboGame.prototype.updateUI = function() {
            this.updateSelectedInfo();
            this.updateScore();
            this.updatePlayerUI();
        };

        ComboGame.prototype.updateScore = function() {
            this.elements.score.textContent = this.score;
            this.elements.combos.textContent = this.combos;
            this.elements.multiplier.textContent = this.multiplier.toFixed(1) + 'x';
            this.elements.level.textContent = this.level;
        };

        ComboGame.prototype.updatePlayerUI = function() {
            this.elements.playerLevel.textContent = this.playerLevel;
            this.elements.totalCoins.textContent = this.totalCoins;
            this.elements.totalScore.textContent = this.totalScore;
            this.elements.gamesPlayed.textContent = this.gamesPlayed;
            
            var xpNeeded = this.playerLevel * 100;
            var xpProgress = (this.totalXP / xpNeeded) * 100;
            
            this.elements.currentXP.textContent = this.totalXP;
            this.elements.xpNeeded.textContent = xpNeeded;
            this.elements.xpFill.style.width = xpProgress + '%';
        };

        ComboGame.prototype.updateSelectedInfo = function() {
            this.elements.selectedCount.textContent = this.selected.length;
            
            var figures = '';
            if (this.selected.length > 0) {
                figures = ' ';
                for (var i = 0; i < this.selected.length; i++) {
                    figures += this.selected[i].figure + ' ';
                }
            }
            this.elements.selectedFigures.textContent = figures;
        };

        ComboGame.prototype.showMessage = function(text, type, animate) {
            this.elements.message.textContent = text;
            this.elements.message.className = 'message';
            
            if (type && this.elements.message.classList) {
                this.elements.message.classList.add(type);
            }
            
            if (animate && this.elements.message.classList) {
                this.elements.message.classList.add('animate');
                var self = this;
                setTimeout(function() {
                    if (self.elements.message.classList) {
                        self.elements.message.classList.remove('animate');
                    }
                }, ANIMATION_DELAY);
            }
        };

        ComboGame.prototype.clearMessage = function() {
            this.elements.message.textContent = '';
            this.elements.message.className = 'message';
        };

        ComboGame.prototype.disableGame = function() {
            var container = document.querySelector('.container');
            if (container && container.classList) {
                container.classList.add('game-disabled');
            }
        };

        ComboGame.prototype.enableGame = function() {
            this.isProcessing = false;
            var container = document.querySelector('.container');
            if (container && container.classList) {
                container.classList.remove('game-disabled');
            }
            this.updateCellStates();
        };

        ComboGame.prototype.resetGame = function() {
            if (this.isProcessing) return;
            
            this.stopTimer();
            this.score = 0;
            this.combos = 0;
            this.level = 1;
            this.multiplier = 1;
            this.selected = [];
            this.isProcessing = false;
            this.isPaused = false;
            this.gameStartTime = Date.now();
            this.levelStartTime = Date.now();
            
            // Reset dados espec√≠ficos do modo
            this.infectedCells = [];
            this.cascadeLevel = 0;
            
            this.elements.pauseButton.textContent = '‚è∏Ô∏è Pausar';
            
            this.initModeSpecifics();
            this.updateModeUI();
            this.initGrid();
            this.renderGrid();
            this.updateUI();
            this.clearMessage();
        };

        ComboGame.prototype.returnToMenu = function() {
            if (this.gameActive) {
                this.totalScore = Math.max(this.totalScore, this.score);
                this.saveProgress();
            }
            
            this.gameActive = false;
            this.stopTimer();
            
            // Mostrar menu e esconder jogo
            document.querySelector('.mode-selector').style.display = 'block';
            document.querySelector('.shop').style.display = 'block';
            this.elements.gameStats.style.display = 'none';
            this.elements.levelProgress.style.display = 'none';
            this.elements.gridContainer.style.display = 'none';
            this.elements.controls.style.display = 'none';
            this.elements.specialModeUI.style.display = 'none';
            
            this.renderShop();
            this.updatePlayerUI();
            this.showMessage('Bem-vindo de volta ao menu principal!', 'success');
        };

        ComboGame.prototype.saveProgress = function() {
            savePlayerData();
        };

        var game;

        function startGame() {
            game = new ComboGame();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startGame);
        } else {
            startGame();
        }
    </script>
</body>
</html>
