<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clínica Dental – Sistema de Agendamento</title>

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/react-calendar@4.0.0/dist/Calendar.css" />

  <style>
    @keyframes slideIn {from{transform:translateY(-20px);opacity:0;}to{transform:translateY(0);opacity:1;}}
    .animate-slideIn{animation:slideIn .3s ease-out;}
    ::-webkit-scrollbar{width:10px;height:10px;}
    ::-webkit-scrollbar-track{background:#f3f4f6;border-radius:5px;}
    ::-webkit-scrollbar-thumb{background:#14b8a6;border-radius:5px;border:2px solid #f3f4f6;}
    ::-webkit-scrollbar-thumb:hover{background:#0d9488;}
    .skip-link{position:absolute;top:-40px;left:0;background:#14b8a6;color:#fff;padding:8px;border-radius:0 0 4px 0;}
    .skip-link:focus{top:0;}
    .btn-icon-text{display:flex;align-items:center;gap:.5rem;min-height:44px;}
    @media(max-width:640px){.btn-text-responsive{font-size:.875rem}.btn-icon-only-mobile span{display:none}}
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-teal-50 min-h-screen">
  <a href="#main-content" class="skip-link">Pular para o conteúdo principal</a>
  <div id="root"></div>
  <div id="aria-live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>

  <!-- JS libs -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-calendar@4.0.0/dist/Calendar.umd.js"></script>

  <script type="text/babel">

    const Calendar = window.ReactCalendar.default;
    const {useState,useEffect,useRef,useMemo,useCallback,memo}=React;

    /* ******************** Config ************************ */
    const CLINIC_CONFIG={workDays:[1,2,3,4,5],workHours:{start:'08:00',end:'18:00',lunchStart:'12:00',lunchEnd:'13:00'},appointmentDuration:30,holidays:[],minPasswordLength:8,sessionTimeout:1800000,maxLoginAttempts:5};

    /* ******************** Utils ************************ */
    const announce=msg=>{const r=document.getElementById('aria-live-region');if(r){r.textContent=msg;setTimeout(()=>r.textContent='',1e3)}};

    const useLocalStorage=(key,init)=>{const [v,setV]=useState(()=>{try{const i=localStorage.getItem(key);return i?JSON.parse(i):init}catch(e){return init}});const set=val=>{try{const s=val instanceof Function?val(v):val;setV(s);localStorage.setItem(key,JSON.stringify(s));}catch(e){}};return [v,set];};

    const validateEmail=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);

    /* ******************** Components ************************ */

    /* Toast */
    const useToast=()=>{const[t,setT]=useState([]);const show=(m,t='info',d=3e3)=>{const id=Date.now();setT(p=>[...p,{id,message:m,type:t}]);setTimeout(()=>setT(p=>p.filter(o=>o.id!==id)),d)};return{toasts:t,showToast:show};};
    const Toast=({toast})=>(<div className="bg-blue-500 text-white px-4 py-2 rounded shadow animate-slideIn">{toast.message}</div>);

    /* Dashboard (colors fixed) */
    const Dashboard=memo(({appointments})=>{
      const stats=useMemo(()=>{
        const today=(new Date).toISOString().split('T')[0];
        const thisMonth=(new Date).toISOString().slice(0,7);
        return{total:appointments.length,today:appointments.filter(a=>a.date===today).length,month:appointments.filter(a=>a.date.startsWith(thisMonth)).length,confirmed:appointments.filter(a=>a.confirmed).length}
      },[appointments]);
      const cards=[{c:'blue',icon:'fa-calendar-alt',label:'Total',value:stats.total},
                   {c:'green',icon:'fa-check',label:'Confirmadas',value:stats.confirmed},
                   {c:'yellow',icon:'fa-clock',label:'Hoje',value:stats.today},
                   {c:'purple',icon:'fa-calendar-check',label:'Mês',value:stats.month}];
      const bg={blue:'bg-blue-100',green:'bg-green-100',yellow:'bg-yellow-100',purple:'bg-purple-100'};
      const tx={blue:'text-blue-600',green:'text-green-600',yellow:'text-yellow-600',purple:'text-purple-600'};
      return(<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        {cards.map((k,i)=>(<div key={i} className="bg-white p-6 rounded-xl shadow">
          <div className={`p-3 rounded-lg ${bg[k.c]} inline-block`}><i className={`fas ${k.icon} ${tx[k.c]}`}/></div>
          <h3 className="text-2xl font-bold mt-4">{k.value}</h3><p className="text-sm text-gray-500">{k.label}</p>
        </div>))}
      </div>)
    });

    /* Main App */
    const App=()=>{
      const[appointments,setAppointments]=useLocalStorage('appointments',[]);
      const[showForm,setShowForm]=useState(false);
      const[calendarOpen,setCalendarOpen]=useState(false);
      const[form,{patientName='',date:'',time:'',phone:''}]=useState({patientName:'',date:'',time:'',phone:''});
      const {toasts,showToast}=useToast();

      const addAppointment=e=>{
        e.preventDefault();
        if(!patientName||!date||!time){showToast('Preencha todos os campos','error');return;}
        setAppointments(p=>[...p,{id:Date.now(),patientName,date,time,phone,confirmed:false}]);
        setShowForm(false);showToast('Agendado com sucesso','success');
      };

      return(<div className="container mx-auto px-4 py-8 max-w-4xl">
        {/* Toasts */}
        <div className="fixed top-4 right-4 space-y-2">{toasts.map(t=><Toast key={t.id} toast={t}/> )}</div>

        <header className="bg-white p-6 rounded-xl shadow mb-8 flex justify-between items-center">
          <h1 className="text-2xl font-bold flex items-center gap-2"><i className="fas fa-tooth text-teal-500"/>Clínica Dental</h1>
          <button onClick={()=>setShowForm(true)} className="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600 btn-icon-text"><i className="fas fa-plus"/>Nova Consulta</button>
        </header>

        <Dashboard appointments={appointments}/>

        {/* Lista simples */}
        <ul className="space-y-4">
          {appointments.map(a=>(<li key={a.id} className="bg-white p-4 rounded-xl shadow flex justify-between items-center">
            <div><p className="font-medium">{a.patientName}</p><p className="text-sm text-gray-500">{a.date} – {a.time}</p></div>
            <span className={`px-2 py-1 rounded text-sm ${a.confirmed?'bg-green-100 text-green-700':'bg-yellow-100 text-yellow-700'}`}>{a.confirmed?'Confirmado':'Pendente'}</span>
          </li>))}
        </ul>

        {/* Formulário */}
        {showForm&&(<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
          <div className="bg-white p-6 rounded-xl shadow w-full max-w-md animate-slideIn">
            <h2 className="text-xl font-bold mb-4">Nova Consulta</h2>
            <form onSubmit={addAppointment} className="space-y-4">
              <input placeholder="Nome do paciente" className="w-full border px-3 py-2 rounded" value={patientName} onChange={e=>form.patientName=e.target.value}/>
              <div className="flex gap-2">
                <input type="date" className="flex-1 border px-3 py-2 rounded" value={date} onChange={e=>form.date=e.target.value}/>
                <button type="button" onClick={()=>setCalendarOpen(true)} className="px-3 rounded bg-blue-500 text-white"><i className="fas fa-calendar"/></button>
              </div>
              {calendarOpen&&(<div className="fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center" onClick={()=>setCalendarOpen(false)}>
                <div className="bg-white p-4 rounded shadow" onClick={e=>e.stopPropagation()}>
                  <Calendar locale="pt-BR" onChange={d=>{form.date=new Date(d).toISOString().split('T')[0];setCalendarOpen(false);}}/>
                </div>
              </div>)}
              <input type="time" className="w-full border px-3 py-2 rounded" value={time} onChange={e=>form.time=e.target.value}/>
              <input placeholder="WhatsApp" className="w-full border px-3 py-2 rounded" value={phone} onChange={e=>form.phone=e.target.value}/>
              <div className="flex gap-2">
                <button type="button" className="flex-1 border px-4 py-2 rounded" onClick={()=>setShowForm(false)}>Cancelar</button>
                <button type="submit" className="flex-1 bg-teal-500 text-white px-4 py-2 rounded">Salvar</button>
              </div>
            </form>
          </div>
        </div>)}
      </div>);
    };

    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
