<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Clínica Dental - Sistema de Agendamento</title>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>

        /* Animações customizadas */

        @keyframes slideIn {

            from { transform: translateY(-20px); opacity: 0; }

            to { transform: translateY(0); opacity: 1; }

        }

       

        .animate-slideIn {

            animation: slideIn 0.3s ease-out;

        }

       

        /* Scrollbar customizada */

        ::-webkit-scrollbar {

            width: 8px;

            height: 8px;

        }

       

        ::-webkit-scrollbar-track {

            background: #f1f1f1;

            border-radius: 4px;

        }

       

        ::-webkit-scrollbar-thumb {

            background: #14b8a6;

            border-radius: 4px;

        }

       

        ::-webkit-scrollbar-thumb:hover {

            background: #0d9488;

        }

       

        /* Loading spinner */

        .spinner {

            border: 3px solid #f3f3f3;

            border-top: 3px solid #14b8a6;

            border-radius: 50%;

            width: 40px;

            height: 40px;

            animation: spin 1s linear infinite;

        }

       

        @keyframes spin {

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }

        }

       

        /* Melhorias para botões pequenos */

        .btn-icon-text {

            display: flex;

            align-items: center;

            justify-content: center;

            gap: 0.5rem;

        }

       

        /* Responsividade para textos em botões */

        @media (max-width: 640px) {

            .btn-text-responsive {

                font-size: 0.875rem;

            }

            .btn-icon-only-mobile span {

                display: none;

            }

        }

    </style>

</head>

<body class="bg-gradient-to-br from-blue-50 to-teal-50 min-h-screen">

    <div id="root"></div>

    <!-- React e ReactDOM -->

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

   

    <!-- Babel para JSX -->

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

   

    <!-- Bibliotecas adicionais -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

   

    <script type="text/babel">

        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // Configurações da clínica

        const CLINIC_CONFIG = {

            workDays: [1, 2, 3, 4, 5], // Segunda a Sexta

            workHours: {

                start: '08:00',

                end: '18:00',

                lunchStart: '12:00',

                lunchEnd: '13:00'

            },

            appointmentDuration: 30, // minutos

            holidays: ['2024-01-01', '2024-12-25']

        };

        // Hook customizado para localStorage

        const useLocalStorage = (key, initialValue) => {

            const [storedValue, setStoredValue] = useState(() => {

                try {

                    const item = window.localStorage.getItem(key);

                    return item ? JSON.parse(item) : initialValue;

                } catch (error) {

                    console.error(`Erro ao carregar ${key}:`, error);

                    return initialValue;

                }

            });

            const setValue = (value) => {

                try {

                    setStoredValue(value);

                    window.localStorage.setItem(key, JSON.stringify(value));

                } catch (error) {

                    console.error(`Erro ao salvar ${key}:`, error);

                }

            };

            return [storedValue, setValue];

        };

        // Hook para gerenciar toasts

        const useToast = () => {

            const [toasts, setToasts] = useState([]);

           

            const showToast = (message, type = 'info') => {

                const id = Date.now();

                setToasts(prev => [...prev, { id, message, type }]);

            };

           

            const removeToast = (id) => {

                setToasts(prev => prev.filter(toast => toast.id !== id));

            };

           

            return { toasts, showToast, removeToast };

        };

        // Componente de Toast

        const Toast = ({ toast, onClose }) => {

            useEffect(() => {

                const timer = setTimeout(() => onClose(toast.id), 3000);

                return () => clearTimeout(timer);

            }, [toast.id, onClose]);

           

            const icons = {

                success: 'fa-check-circle',

                error: 'fa-exclamation-circle',

                warning: 'fa-exclamation-triangle',

                info: 'fa-info-circle'

            };

           

            const colors = {

                success: 'bg-green-500',

                error: 'bg-red-500',

                warning: 'bg-yellow-500',

                info: 'bg-blue-500'

            };

           

            return (

                <div className={`${colors[toast.type]} text-white px-6 py-4 rounded-lg

                    shadow-lg flex items-center space-x-3 z-50 animate-slideIn max-w-md`}>

                    <i className={`fas ${icons[toast.type]} text-xl flex-shrink-0`}></i>

                    <span className="flex-1">{toast.message}</span>

                    <button onClick={() => onClose(toast.id)} className="ml-4 hover:opacity-80 flex-shrink-0">

                        <i className="fas fa-times"></i>

                    </button>

                </div>

            );

        };

        // Componente de Modal de Confirmação

        const ConfirmDialog = ({ isOpen, onClose, onConfirm, title, message }) => {

            if (!isOpen) return null;

           

            return (

                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">

                    <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm animate-slideIn">

                        <h3 className="text-xl font-bold text-gray-900 mb-4">{title}</h3>

                        <p className="text-gray-600 mb-6">{message}</p>

                        <div className="flex flex-col sm:flex-row gap-3">

                            <button

                                onClick={onClose}

                                className="flex-1 px-4 py-2 border border-gray-300 text-gray-700

                                    rounded-lg hover:bg-gray-50 transition-colors"

                            >

                                Cancelar

                            </button>

                            <button

                                onClick={() => {

                                    onConfirm();

                                    onClose();

                                }}

                                className="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg

                                    hover:bg-red-600 transition-colors"

                            >

                                Confirmar

                            </button>

                        </div>

                    </div>

                </div>

            );

        };

        // Utilitários de validação

        const validatePhone = (phone) => {

            const cleaned = phone.replace(/\D/g, '');

            const patterns = {

                mobile: /^55\d{2}9\d{8}$/,

                landline: /^55\d{2}\d{8}$/,

            };

           

            const isValid = patterns.mobile.test(cleaned) || patterns.landline.test(cleaned);

           

            return {

                isValid,

                formatted: isValid ? formatPhoneNumber(cleaned) : phone,

                error: !isValid ? 'Número de telefone inválido' : null

            };

        };

        const formatPhoneNumber = (number) => {

            const cleaned = number.replace(/\D/g, '');

           

            if (cleaned.length === 13) {

                return `+${cleaned.slice(0, 2)} (${cleaned.slice(2, 4)}) ${cleaned.slice(4, 9)}-${cleaned.slice(9)}`;

            } else if (cleaned.length === 12) {

                return `+${cleaned.slice(0, 2)} (${cleaned.slice(2, 4)}) ${cleaned.slice(4, 8)}-${cleaned.slice(8)}`;

            }

           

            return number;

        };

        const validateDate = (date) => {

            const selected = new Date(date);

            const today = new Date();

            today.setHours(0, 0, 0, 0);

           

            if (selected < today) {

                return { isValid: false, error: 'Não é possível agendar em datas passadas' };

            }

           

            const dayOfWeek = selected.getDay();

            if (!CLINIC_CONFIG.workDays.includes(dayOfWeek)) {

                return { isValid: false, error: 'A clínica não atende neste dia da semana' };

            }

           

            const dateStr = selected.toISOString().split('T')[0];

            if (CLINIC_CONFIG.holidays.includes(dateStr)) {

                return { isValid: false, error: 'A clínica não atende em feriados' };

            }

           

            return { isValid: true, error: null };

        };

        const timeToMinutes = (time) => {

            const [hours, minutes] = time.split(':').map(Number);

            return hours * 60 + minutes;

        };

        const validateTime = (time, date, existingAppointments) => {

            const [hours, minutes] = time.split(':').map(Number);

            const timeMinutes = hours * 60 + minutes;

            const startMinutes = timeToMinutes(CLINIC_CONFIG.workHours.start);

            const endMinutes = timeToMinutes(CLINIC_CONFIG.workHours.end);

            const lunchStartMinutes = timeToMinutes(CLINIC_CONFIG.workHours.lunchStart);

            const lunchEndMinutes = timeToMinutes(CLINIC_CONFIG.workHours.lunchEnd);

           

            if (timeMinutes < startMinutes || timeMinutes >= endMinutes) {

                return {

                    isValid: false,

                    error: `Horário fora do expediente (${CLINIC_CONFIG.workHours.start} - ${CLINIC_CONFIG.workHours.end})`

                };

            }

           

            if (timeMinutes >= lunchStartMinutes && timeMinutes < lunchEndMinutes) {

                return {

                    isValid: false,

                    error: 'Horário de almoço não disponível'

                };

            }

           

            const hasConflict = existingAppointments.some(apt => {

                if (apt.date !== date) return false;

               

                const aptMinutes = timeToMinutes(apt.time);

                const aptEndMinutes = aptMinutes + CLINIC_CONFIG.appointmentDuration;

                const newEndMinutes = timeMinutes + CLINIC_CONFIG.appointmentDuration;

               

                return (timeMinutes >= aptMinutes && timeMinutes < aptEndMinutes) ||

                       (newEndMinutes > aptMinutes && newEndMinutes <= aptEndMinutes);

            });

           

            if (hasConflict) {

                return {

                    isValid: false,

                    error: 'Este horário já está ocupado'

                };

            }

           

            return { isValid: true, error: null };

        };

        const formatDate = (dateString) => {

            const date = new Date(dateString);

            return date.toLocaleDateString('pt-BR', {

                weekday: 'short',

                day: '2-digit',

                month: '2-digit'

            });

        };

        const sanitizeInput = (input) => {

            return input

                .replace(/[<>]/g, '')

                .trim()

                .slice(0, 100);

        };

        // Componente de Input de Telefone

        const PhoneInput = ({ value, onChange, error }) => {

            const handleChange = (e) => {

                let input = e.target.value;

               

                input = input.replace(/[^\d+\s()-]/g, '');

               

                if (input.startsWith('+55')) {

                    const numbers = input.replace(/\D/g, '');

                    if (numbers.length > 2) {

                        let formatted = `+${numbers.slice(0, 2)}`;

                        if (numbers.length > 2) {

                            formatted += ` (${numbers.slice(2, 4)}`;

                            if (numbers.length > 4) {

                                formatted += `) ${numbers.slice(4, 9)}`;

                                if (numbers.length > 9) {

                                    formatted += `-${numbers.slice(9, 13)}`;

                                }

                            }

                        }

                        input = formatted;

                    }

                }

               

                onChange({ target: { name: 'phone', value: input } });

            };

           

            return (

                <div>

                    <input

                        type="tel"

                        name="phone"

                        value={value}

                        onChange={handleChange}

                        placeholder="+55 (11) 99999-9999"

                        className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-teal-500

                            ${error ? 'border-red-500' : 'border-gray-300'}`}

                        required

                    />

                    {error && <p className="text-red-500 text-sm mt-1">{error}</p>}

                </div>

            );

        };

        // Componente de Dashboard

        const Dashboard = ({ appointments }) => {

            const stats = useMemo(() => {

                const today = new Date().toISOString().split('T')[0];

                const thisMonth = new Date().toISOString().slice(0, 7);

               

                return {

                    total: appointments.length,

                    todayCount: appointments.filter(apt => apt.date === today).length,

                    monthCount: appointments.filter(apt => apt.date.startsWith(thisMonth)).length,

                    confirmed: appointments.filter(apt => apt.confirmed).length,

                    pending: appointments.filter(apt => !apt.confirmed).length,

                    confirmationRate: appointments.length > 0

                        ? Math.round((appointments.filter(apt => apt.confirmed).length / appointments.length) * 100)

                        : 0

                };

            }, [appointments]);

           

            return (

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">

                    <div className="bg-white rounded-xl shadow-md p-6 transform hover:scale-105 transition-transform">

                        <div className="flex items-center justify-between mb-4">

                            <div className="bg-blue-100 p-3 rounded-lg">

                                <i className="fas fa-calendar-alt text-blue-600 text-xl"></i>

                            </div>

                            <span className="text-sm text-gray-500">Total</span>

                        </div>

                        <h3 className="text-2xl font-bold text-gray-900">{stats.total}</h3>

                        <p className="text-sm text-gray-600 mt-1">Agendamentos</p>

                    </div>

                   

                    <div className="bg-white rounded-xl shadow-md p-6 transform hover:scale-105 transition-transform">

                        <div className="flex items-center justify-between mb-4">

                            <div className="bg-green-100 p-3 rounded-lg">

                                <i className="fas fa-check-circle text-green-600 text-xl"></i>

                            </div>

                            <span className="text-sm text-gray-500">Taxa</span>

                        </div>

                        <h3 className="text-2xl font-bold text-gray-900">{stats.confirmationRate}%</h3>

                        <p className="text-sm text-gray-600 mt-1">Confirmação</p>

                    </div>

                   

                    <div className="bg-white rounded-xl shadow-md p-6 transform hover:scale-105 transition-transform">

                        <div className="flex items-center justify-between mb-4">

                            <div className="bg-yellow-100 p-3 rounded-lg">

                                <i className="fas fa-clock text-yellow-600 text-xl"></i>

                            </div>

                            <span className="text-sm text-gray-500">Hoje</span>

                        </div>

                        <h3 className="text-2xl font-bold text-gray-900">{stats.todayCount}</h3>

                        <p className="text-sm text-gray-600 mt-1">Consultas</p>

                    </div>

                   

                    <div className="bg-white rounded-xl shadow-md p-6 transform hover:scale-105 transition-transform">

                        <div className="flex items-center justify-between mb-4">

                            <div className="bg-purple-100 p-3 rounded-lg">

                                <i className="fas fa-calendar-check text-purple-600 text-xl"></i>

                            </div>

                            <span className="text-sm text-gray-500">Mês</span>

                        </div>

                        <h3 className="text-2xl font-bold text-gray-900">{stats.monthCount}</h3>

                        <p className="text-sm text-gray-600 mt-1">Agendadas</p>

                    </div>

                </div>

            );

        };

        // Componente de Busca e Filtros

        const SearchAndFilters = ({ onSearchChange, onFilterChange, onSortChange }) => {

            const [searchTerm, setSearchTerm] = useState('');

            const [dateRange, setDateRange] = useState({ start: '', end: '' });

            const [statusFilter, setStatusFilter] = useState('all');

            const [sortBy, setSortBy] = useState('date-asc');

           

            useEffect(() => {

                onSearchChange(searchTerm);

            }, [searchTerm, onSearchChange]);

           

            useEffect(() => {

                onFilterChange({ dateRange, statusFilter });

            }, [dateRange, statusFilter, onFilterChange]);

           

            useEffect(() => {

                onSortChange(sortBy);

            }, [sortBy, onSortChange]);

           

            return (

                <div className="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-6">

                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

                        <div className="relative sm:col-span-2 lg:col-span-1">

                            <input

                                type="text"

                                value={searchTerm}

                                onChange={(e) => setSearchTerm(e.target.value)}

                                placeholder="Buscar paciente ou telefone..."

                                className="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg

                                    focus:ring-2 focus:ring-teal-500"

                            />

                            <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>

                        </div>

                       

                        <div className="flex gap-2 sm:col-span-2 lg:col-span-2">

                            <input

                                type="date"

                                value={dateRange.start}

                                onChange={(e) => setDateRange(prev => ({ ...prev, start: e.target.value }))}

                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg

                                    focus:ring-2 focus:ring-teal-500 min-w-[140px]"

                            />

                            <input

                                type="date"

                                value={dateRange.end}

                                onChange={(e) => setDateRange(prev => ({ ...prev, end: e.target.value }))}

                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg

                                    focus:ring-2 focus:ring-teal-500 min-w-[140px]"

                            />

                        </div>

                       

                        <select

                            value={statusFilter}

                            onChange={(e) => setStatusFilter(e.target.value)}

                            className="px-3 py-2 border border-gray-300 rounded-lg

                                focus:ring-2 focus:ring-teal-500"

                        >

                            <option value="all">Todos os status</option>

                            <option value="confirmed">Confirmadas</option>

                            <option value="pending">Aguardando confirmação</option>

                            <option value="not-contacted">Não contactadas</option>

                        </select>

                       

                        <select

                            value={sortBy}

                            onChange={(e) => setSortBy(e.target.value)}

                            className="px-3 py-2 border border-gray-300 rounded-lg

                                focus:ring-2 focus:ring-teal-500"

                        >

                            <option value="date-asc">Data (mais próxima)</option>

                            <option value="date-desc">Data (mais distante)</option>

                            <option value="name-asc">Nome (A-Z)</option>

                            <option value="name-desc">Nome (Z-A)</option>

                        </select>

                    </div>

                </div>

            );

        };

        // Componente de Exportação

        const ExportButtons = ({ appointments, showToast }) => {

            const exportToExcel = () => {

                try {

                    const worksheet = XLSX.utils.json_to_sheet(

                        appointments.map(apt => ({

                            'Paciente': apt.patientName,

                            'Data': formatDate(apt.date),

                            'Horário': apt.time,

                            'Telefone': apt.phone,

                            'Status': apt.confirmed ? 'Confirmado' : 'Pendente',

                            'Mensagem Enviada': apt.sentMessage ? 'Sim' : 'Não'

                        }))

                    );

                   

                    const workbook = XLSX.utils.book_new();

                    XLSX.utils.book_append_sheet(workbook, worksheet, 'Agendamentos');

                    XLSX.writeFile(workbook, `agendamentos_${new Date().toISOString().split('T')[0]}.xlsx`);

                    showToast('Arquivo Excel exportado com sucesso!', 'success');

                } catch (error) {

                    showToast('Erro ao exportar Excel', 'error');

                }

            };

           

            const generatePDFReport = () => {

                try {

                    const { jsPDF } = window.jspdf;

                    const doc = new jsPDF();

                   

                    // Cabeçalho

                    doc.setFontSize(20);

                    doc.text('Relatório de Agendamentos', 20, 20);

                    doc.setFontSize(12);

                    doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);

                   

                    // Estatísticas

                    const confirmed = appointments.filter(apt => apt.confirmed).length;

                    const confirmationRate = appointments.length > 0

                        ? Math.round((confirmed / appointments.length) * 100)

                        : 0;

                   

                    doc.text(`Total de agendamentos: ${appointments.length}`, 20, 45);

                    doc.text(`Taxa de confirmação: ${confirmationRate}%`, 20, 55);

                   

                    // Tabela

                    const tableData = appointments.map(apt => [

                        apt.patientName,

                        formatDate(apt.date),

                        apt.time,

                        apt.confirmed ? 'Confirmado' : 'Pendente'

                    ]);

                   

                    doc.autoTable({

                        head: [['Paciente', 'Data', 'Horário', 'Status']],

                        body: tableData,

                        startY: 70

                    });

                   

                    doc.save(`relatorio_${new Date().toISOString().split('T')[0]}.pdf`);

                    showToast('Relatório PDF gerado com sucesso!', 'success');

                } catch (error) {

                    showToast('Erro ao gerar PDF', 'error');

                }

            };

           

            return (

                <div className="flex flex-col sm:flex-row gap-3 mb-6">

                    <button

                        onClick={exportToExcel}

                        className="bg-green-500 hover:bg-green-600 text-white px-4 py-2

                            rounded-lg btn-icon-text transition-colors btn-icon-only-mobile"

                    >

                        <i className="fas fa-file-excel"></i>

                        <span>Exportar Excel</span>

                    </button>

                    <button

                        onClick={generatePDFReport}

                        className="bg-red-500 hover:bg-red-600 text-white px-4 py-2

                            rounded-lg btn-icon-text transition-colors btn-icon-only-mobile"

                    >

                        <i className="fas fa-file-pdf"></i>

                        <span>Gerar Relatório PDF</span>

                    </button>

                </div>

            );

        };

        // Componente Principal

        const App = () => {

            const [appointments, setAppointments] = useLocalStorage('clinica-appointments', []);

            const [showForm, setShowForm] = useState(false);

            const [formData, setFormData] = useState({

                patientName: '',

                date: '',

                time: '',

                phone: ''

            });

            const [formErrors, setFormErrors] = useState({});

            const [filter, setFilter] = useState('all');

            const [searchTerm, setSearchTerm] = useState('');

            const [filterOptions, setFilterOptions] = useState({ dateRange: { start: '', end: '' }, statusFilter: 'all' });

            const [sortBy, setSortBy] = useState('date-asc');

            const [deleteConfirm, setDeleteConfirm] = useState({ show: false, id: null });

            const { toasts, showToast, removeToast } = useToast();

            useEffect(() => {

                const today = new Date().toISOString().split('T')[0];

                setFormData(prev => ({ ...prev, date: today }));

            }, []);

            const handleInputChange = (e) => {

                const { name, value } = e.target;

                const sanitized = name === 'patientName' ? sanitizeInput(value) : value;

                setFormData(prev => ({ ...prev, [name]: sanitized }));

               

                // Limpar erro do campo quando o usuário digita

                if (formErrors[name]) {

                    setFormErrors(prev => ({ ...prev, [name]: null }));

                }

            };

            const validateForm = () => {

                const errors = {};

               

                if (!formData.patientName.trim()) {

                    errors.patientName = 'Nome é obrigatório';

                }

               

                const dateValidation = validateDate(formData.date);

                if (!dateValidation.isValid) {

                    errors.date = dateValidation.error;

                }

               

                const timeValidation = validateTime(formData.time, formData.date, appointments);

                if (!timeValidation.isValid) {

                    errors.time = timeValidation.error;

                }

               

                const phoneValidation = validatePhone(formData.phone);

                if (!phoneValidation.isValid) {

                    errors.phone = phoneValidation.error;

                }

               

                setFormErrors(errors);

                return Object.keys(errors).length === 0;

            };

            const handleSubmit = (e) => {

                e.preventDefault();

               

                if (!validateForm()) {

                    showToast('Por favor, corrija os erros no formulário', 'error');

                    return;

                }

               

                const phoneValidation = validatePhone(formData.phone);

                const newAppointment = {

                    id: Date.now(),

                    ...formData,

                    phone: phoneValidation.formatted,

                    confirmed: false,

                    sentMessage: false,

                    createdAt: new Date().toISOString()

                };

               

                setAppointments(prev => [...prev, newAppointment]);

                setFormData({ patientName: '', date: '', time: '', phone: '' });

                setFormErrors({});

                setShowForm(false);

                showToast('Agendamento criado com sucesso!', 'success');

            };

            const sendMessage = useCallback((appointment) => {

                const message = `Olá ${appointment.patientName}, gostaríamos de confirmar sua consulta odontológica marcada para ${formatDate(appointment.date)} às ${appointment.time}. Por favor, responda com SIM para confirmar ou NÃO para remarcar. Obrigado!`;

                const whatsappUrl = `https://wa.me/${appointment.phone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;

                window.open(whatsappUrl, '_blank');

               

                setAppointments(prev =>

                    prev.map(apt =>

                        apt.id === appointment.id

                            ? { ...apt, sentMessage: true }

                            : apt

                    )

                );

                showToast('Mensagem enviada via WhatsApp', 'success');

            }, [setAppointments, showToast]);

            const confirmAppointment = useCallback((id) => {

                setAppointments(prev =>

                    prev.map(apt =>

                        apt.id === id

                            ? { ...apt, confirmed: true }

                            : apt

                    )

                );

                showToast('Consulta confirmada!', 'success');

            }, [setAppointments, showToast]);

            const deleteAppointment = useCallback((id) => {

                setAppointments(prev => prev.filter(apt => apt.id !== id));

                showToast('Agendamento excluído', 'info');

                setDeleteConfirm({ show: false, id: null });

            }, [setAppointments, showToast]);

            const filteredAppointments = useMemo(() => {

                let filtered = [...appointments];

               

                // Busca por texto

                if (searchTerm) {

                    filtered = filtered.filter(apt =>

                        apt.patientName.toLowerCase().includes(searchTerm.toLowerCase()) ||

                        apt.phone.includes(searchTerm)

                    );

                }

               

                // Filtro de data

                const { dateRange, statusFilter } = filterOptions;

                if (dateRange.start) {

                    filtered = filtered.filter(apt => apt.date >= dateRange.start);

                }

                if (dateRange.end) {

                    filtered = filtered.filter(apt => apt.date <= dateRange.end);

                }

               

                // Filtro de status

                if (statusFilter !== 'all') {

                    filtered = filtered.filter(apt => {

                        if (statusFilter === 'confirmed') return apt.confirmed;

                        if (statusFilter === 'pending') return !apt.confirmed && apt.sentMessage;

                        if (statusFilter === 'not-contacted') return !apt.sentMessage;

                        return true;

                    });

                }

               

                // Filtro rápido

                if (filter !== 'all') {

                    filtered = filtered.filter(apt => {

                        if (filter === 'confirmed') return apt.confirmed;

                        if (filter === 'pending') return !apt.confirmed;

                        return true;

                    });

                }

               

                // Ordenação

                filtered.sort((a, b) => {

                    switch (sortBy) {

                        case 'date-asc':

                            return new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time);

                        case 'date-desc':

                            return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);

                        case 'name-asc':

                            return a.patientName.localeCompare(b.patientName);

                        case 'name-desc':

                            return b.patientName.localeCompare(a.patientName);

                        default:

                            return 0;

                    }

                });

               

                return filtered;

            }, [appointments, searchTerm, filterOptions, filter, sortBy]);

            return (

                <div className="container mx-auto px-4 py-8 max-w-7xl">

                    {/* Toasts */}

                    <div className="fixed top-4 right-4 z-50 space-y-2">

                        {toasts.map(toast => (

                            <Toast key={toast.id} toast={toast} onClose={removeToast} />

                        ))}

                    </div>

                    {/* Header */}

                    <div className="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-8">

                        <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">

                            <div>

                                <h1 className="text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-3">

                                    <i className="fas fa-tooth text-teal-500"></i>

                                    <span>Clínica Dental</span>

                                </h1>

                                <p className="text-gray-600 mt-2">Sistema de Agendamento</p>

                            </div>

                            <button

                                onClick={() => setShowForm(true)}

                                className="w-full sm:w-auto bg-teal-500 hover:bg-teal-600 text-white px-6 py-3 rounded-lg

                                    btn-icon-text transition-colors duration-200 shadow-md

                                    transform hover:scale-105"

                            >

                                <i className="fas fa-plus"></i>

                                <span>Nova Consulta</span>

                            </button>

                        </div>

                    </div>

                    {/* Dashboard */}

                    <Dashboard appointments={appointments} />

                    {/* Busca e Filtros */}

                    <SearchAndFilters

                        onSearchChange={setSearchTerm}

                        onFilterChange={setFilterOptions}

                        onSortChange={setSortBy}

                    />

                    {/* Botões de Exportação */}

                    {filteredAppointments.length > 0 && (

                        <ExportButtons appointments={filteredAppointments} showToast={showToast} />

                    )}

                    {/* Filtros Rápidos */}

                    <div className="flex flex-wrap gap-2 sm:gap-4 mb-6">

                        <button

                            onClick={() => setFilter('all')}

                            className={`px-4 py-2 rounded-lg transition-colors duration-200 btn-text-responsive ${

                                filter === 'all'

                                    ? 'bg-teal-500 text-white shadow-md'

                                    : 'bg-white text-gray-700 hover:bg-gray-50'

                            }`}

                        >

                            Todas ({appointments.length})

                        </button>

                        <button

                            onClick={() => setFilter('confirmed')}

                            className={`px-4 py-2 rounded-lg transition-colors duration-200 btn-text-responsive ${

                                filter === 'confirmed'

                                    ? 'bg-green-500 text-white shadow-md'

                                    : 'bg-white text-gray-700 hover:bg-gray-50'

                            }`}

                        >

                            <i className="fas fa-check-circle mr-2"></i>

                            Confirmadas ({appointments.filter(a => a.confirmed).length})

                        </button>

                        <button

                            onClick={() => setFilter('pending')}

                            className={`px-4 py-2 rounded-lg transition-colors duration-200 btn-text-responsive ${

                                filter === 'pending'

                                    ? 'bg-orange-500 text-white shadow-md'

                                    : 'bg-white text-gray-700 hover:bg-gray-50'

                            }`}

                        >

                            <i className="fas fa-clock mr-2"></i>

                            Pendentes ({appointments.filter(a => !a.confirmed).length})

                        </button>

                    </div>

                    {/* Lista de Agendamentos */}

                    <div className="grid gap-4 sm:gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">

                        {filteredAppointments.map((appointment) => (

                            <div

                                key={appointment.id}

                                className="bg-white rounded-xl shadow-lg p-4 sm:p-6 hover:shadow-xl

                                    transition-shadow duration-300"

                            >

                                <div className="flex items-start justify-between mb-4">

                                    <div className="flex items-center gap-3 flex-1 min-w-0">

                                        <div className="bg-teal-100 p-2 rounded-lg flex-shrink-0">

                                            <i className="fas fa-user text-teal-600"></i>

                                        </div>

                                        <div className="min-w-0 flex-1">

<h3 className="font-semibold text-gray-900 truncate">

                                                {appointment.patientName}

                                            </h3>

                                            <p className="text-sm text-gray-500 truncate">{appointment.phone}</p>

                                        </div>

                                    </div>

                                    <button

                                        onClick={() => setDeleteConfirm({ show: true, id: appointment.id })}

                                        className="text-gray-400 hover:text-red-500 transition-colors duration-200 ml-2 flex-shrink-0"

                                    >

                                        <i className="fas fa-trash"></i>

                                    </button>

                                </div>

                                <div className="space-y-3 mb-6">

                                    <div className="flex items-center gap-2 text-gray-600">

                                        <i className="fas fa-calendar flex-shrink-0"></i>

                                        <span className="text-sm">{formatDate(appointment.date)}</span>

                                    </div>

                                    <div className="flex items-center gap-2 text-gray-600">

                                        <i className="fas fa-clock flex-shrink-0"></i>

                                        <span className="text-sm">{appointment.time}</span>

                                    </div>

                                </div>

                                <div className="flex items-center justify-between mb-4">

                                    <div className="flex items-center gap-2">

                                        {appointment.confirmed ? (

                                            <i className="fas fa-check-circle text-green-500"></i>

                                        ) : (

                                            <div className="w-5 h-5 border-2 border-gray-300 rounded-full"></div>

                                        )}

                                        <span className={`text-sm font-medium ${

                                            appointment.confirmed ? 'text-green-600' : 'text-orange-600'

                                        }`}>

                                            {appointment.confirmed ? 'Confirmada' : 'Pendente'}

                                        </span>

                                    </div>

                                    {appointment.sentMessage && (

                                        <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full flex items-center gap-1">

                                            <i className="fas fa-check"></i>

                                            <span className="hidden sm:inline">Mensagem</span> Enviada

                                        </span>

                                    )}

                                </div>

                                <div className="flex flex-col sm:flex-row gap-2">

                                    {!appointment.sentMessage && (

                                        <button

                                            onClick={() => sendMessage(appointment)}

                                            className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3

                                                rounded-lg btn-icon-text transition-colors duration-200

                                                transform hover:scale-105 text-sm"

>

                                            <i className="fab fa-whatsapp"></i>

                                            <span>Enviar WhatsApp</span>

                                        </button>

                                    )}

                                    {!appointment.confirmed && appointment.sentMessage && (

                                        <button

                                            onClick={() => confirmAppointment(appointment.id)}

                                            className="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-3

                                                rounded-lg btn-icon-text transition-colors duration-200

                                                transform hover:scale-105 text-sm"

                                        >

                                            <i className="fas fa-check-circle"></i>

                                            <span>Confirmar</span>

                                        </button>

                                    )}

                                    {appointment.confirmed && (

                                        <div className="flex-1 bg-green-100 text-green-800 py-2 px-3

                                            rounded-lg btn-icon-text text-sm">

                                            <i className="fas fa-check-double"></i>

                                            <span>Consulta Confirmada</span>

                                        </div>

                                    )}

                                </div>

                            </div>

                        ))}

                    </div>

                    {filteredAppointments.length === 0 && (

                        <div className="text-center py-12 bg-white rounded-xl shadow-md">

                            <i className="fas fa-calendar text-gray-300 text-6xl mb-4"></i>

                            <h3 className="text-xl font-medium text-gray-900 mb-2">

                                Nenhuma consulta encontrada

                            </h3>

                            <p className="text-gray-500">

                                {searchTerm || filterOptions.dateRange.start || filterOptions.statusFilter !== 'all'

                                    ? 'Tente ajustar os filtros de busca'

                                    : 'Agende uma nova consulta para começar'}

                            </p>

                        </div>

                    )}

                    {/* Modal de Formulário */}

                    {showForm && (

                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">

                            <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md animate-slideIn">

                                <h2 className="text-2xl font-bold text-gray-900 mb-6">Nova Consulta</h2>

                                <form onSubmit={handleSubmit} className="space-y-4">

                                    <div>

                                        <label className="block text-sm font-medium text-gray-700 mb-1">

                                            Nome do Paciente

                                        </label>

                                        <input

type="text"

                                            name="patientName"

                                            value={formData.patientName}

                                            onChange={handleInputChange}

                                            className={`w-full px-3 py-2 border rounded-lg focus:ring-2

                                                focus:ring-teal-500 focus:border-transparent ${

                                                formErrors.patientName ? 'border-red-500' : 'border-gray-300'

                                            }`}

                                            required

                                        />

                                        {formErrors.patientName && (

                                            <p className="text-red-500 text-sm mt-1">{formErrors.patientName}</p>

                                        )}

                                    </div>

                                    <div>

                                        <label className="block text-sm font-medium text-gray-700 mb-1">

                                            Data

                                        </label>

                                        <input

                                            type="date"

                                            name="date"

                                            value={formData.date}

                                            onChange={handleInputChange}

                                            className={`w-full px-3 py-2 border rounded-lg focus:ring-2

                                                focus:ring-teal-500 focus:border-transparent ${

                                                formErrors.date ? 'border-red-500' : 'border-gray-300'

                                            }`}

                                            required

                                        />

                                        {formErrors.date && (

                                            <p className="text-red-500 text-sm mt-1">{formErrors.date}</p>

                                        )}

                                    </div>

                                    <div>

                                        <label className="block text-sm font-medium text-gray-700 mb-1">

                                            Horário

                                        </label>

                                        <input

                                            type="time"

                                            name="time"

                                            value={formData.time}

                                            onChange={handleInputChange}

                                            className={`w-full px-3 py-2 border rounded-lg focus:ring-2

                                                focus:ring-teal-500 focus:border-transparent ${

                                                formErrors.time ? 'border-red-500' : 'border-gray-300'

                                            }`}

                                            required

                                        />

                                        {formErrors.time && (

                                            <p className="text-red-500 text-sm mt-1">{formErrors.time}</p>

                                        )}

                                    </div>

                                    <div>

                                        <label className="block text-sm font-medium text-gray-700 mb-1">

WhatsApp

                                        </label>

                                        <PhoneInput

                                            value={formData.phone}

                                            onChange={handleInputChange}

                                            error={formErrors.phone}

                                        />

                                    </div>

                                    <div className="flex flex-col sm:flex-row gap-3 pt-4">

                                        <button

                                            type="button"

                                            onClick={() => {

                                                setShowForm(false);

                                                setFormErrors({});

                                            }}

                                            className="flex-1 px-4 py-2 border border-gray-300 text-gray-700

                                                rounded-lg hover:bg-gray-50 transition-colors duration-200"

                                        >

                                            Cancelar

                                        </button>

                                        <button

                                            type="submit"

                                            className="flex-1 px-4 py-2 bg-teal-500 text-white rounded-lg

                                                hover:bg-teal-600 transition-colors duration-200"

                                        >

                                            Agendar

                                        </button>

                                    </div>

                                </form>

                            </div>

                        </div>

                    )}

                    {/* Modal de Confirmação de Exclusão */}

                    <ConfirmDialog

                        isOpen={deleteConfirm.show}

                        onClose={() => setDeleteConfirm({ show: false, id: null })}

                        onConfirm={() => deleteAppointment(deleteConfirm.id)}

                        title="Excluir Agendamento"

                        message="Tem certeza que deseja excluir este agendamento? Esta ação não pode ser desfeita."

                    />

                </div>

            );

        };

        // Renderizar a aplicação

        ReactDOM.render(<App />, document.getElementById('root'));

    </script>

</body>

</html>
